@page
@model InventoryManagement.Pages.IndexModel
@{
    ViewData["Title"] = "House Buddy";
}

<div class="background-hero" aria-hidden="true">
    <div class="shape shape-left" aria-hidden="true">
        <svg viewBox="0 0 600 600" preserveAspectRatio="xMidYMid meet" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                    <stop offset="0" stop-color="#FDEFE8" />
                    <stop offset="1" stop-color="#FBEFE8" />
                </linearGradient>
            </defs>
            <g fill="url(#g1)">
                <path d="M300 30C380 30 520 70 548 150C576 230 520 360 420 420C320 480 190 520 110 460C30 400 20 230 80 150C140 70 220 30 300 30Z" />
            </g>
        </svg>
    </div>

    <div class="shape shape-right" aria-hidden="true">
        <svg viewBox="0 0 520 520" preserveAspectRatio="xMidYMid meet" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="g2" x1="0" x2="1">
                    <stop offset="0" stop-color="#FFECD1" />
                    <stop offset="1" stop-color="#FDEFE8" />
                </linearGradient>
            </defs>
            <g fill="url(#g2)">
                <path d="M260 10C330 30 420 50 490 120C560 190 520 320 420 420C320 520 190 490 110 420C30 350 10 200 60 120C110 40 190 -10 260 10Z" />
            </g>
        </svg>
    </div>
</div>

<div class="container home-outer mt-4 page-content">

    @* <div class="home-hero-spacer"></div> *@

    <div class="home-card mb-3">
        <div class="mb-3">
            <h1 class="page-title mb-0">Manage Items</h1>
        </div>

        <div class="home-card-body">
            <label for="upcInput" class="form-label">Search by UPC</label>

            <!-- SERVER-SIDE SEARCH FORM -->
            <form class="mb-0" role="search" aria-label="Search by UPC"
                  method="post" asp-page-handler="Search">
                <div class="home-search-row">
                    <input id="upcInput"
                           name="UPC"
                           class="form-control"
                           value="@Model.UPC"
                           placeholder="e.g., 012345678905"
                           aria-label="UPC code" />
                    <button class="btn btn-lookup" type="submit">Lookup</button>
                </div>
            </form>

            <!-- Validation / Error messages -->
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-warning mt-3" id="searchError">
                    @foreach (var e in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        @e.ErrorMessage
                
                        <br />
                    }
                </div>
            }

            <!-- SEARCH RESULT (ONLY IF API RETURNED AN ITEM) -->
            @if (Model.SearchedItem is not null)
            {
                var item = Model.SearchedItem;

                <div id="searchResult" class="mt-3">
                    <div class="row g-3 align-items-start">
                        <div class="col-auto">
                            @if (item.Images != null && item.Images.Count > 0)
                            {
                                <img id="srImage"
                                     src="@item.Images[0]"
                                     alt="Product image"
                                     style="max-width:120px; border-radius:8px; background:#f3f3f3; padding:4px;" />
                            }
                        </div>

                        <div class="col">
                            <h5 id="srTitle" class="mb-2">@item.Title</h5>
                            <div><span class="field-label">Brand:</span> <span id="srBrand">@item.Brand</span></div>
                            <div><span class="field-label">Model:</span> <span id="srModel">@item.Model</span></div>
                            <div><span class="field-label">Category:</span> <span id="srCategoryText">@item.Category</span></div>
                            <div><span class="field-label">UPC:</span> <span id="srUpc">@item.Upc</span></div>

                            <hr class="mt-3 mb-3" />

                            <div class="row g-3">
                                <div class="col-6 col-md-3">
                                    <label for="srQty" class="field-label mb-1">Quantity</label>
                                    <input id="srQty" type="number" min="1" value="1"
                                           class="form-control" />
                                </div>

                                <div class="col-6 col-md-3">
                                    <label for="srExpiry" class="field-label mb-1">Expiry Date</label>
                                    <input id="srExpiry" type="date" class="form-control" />
                                </div>

                                <div class="col-12 col-md-4">
                                    <label for="srCategorySelect" class="field-label mb-1">Category</label>
                                    <select id="srCategorySelect" class="form-select">
                                        <option value="">Select category</option>
                                        <option value="Pantry">Pantry</option>
                                        <option value="Fridge">Fridge</option>
                                        <option value="Freezer">Freezer</option>
                                        <option value="Bathroom">Bathroom</option>
                                        <option value="Cleaning">Cleaning</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>

                                <div class="col-12 col-md-6">
                                    <label for="srLocation" class="field-label mb-1">Location (optional)</label>
                                    <input id="srLocation" class="form-control"
                                           placeholder="e.g., Kitchen cabinet, Top shelf" />
                                </div>
                            </div>

                            <div class="mt-3 d-flex flex-wrap gap-2">
                                <!-- For now this is just UI; we'll wire this to a POST handler later -->
                                <button id="btnAdd" class="btn btn-success" type="button" disabled>
                                    Add to Inventory
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

</div>

